import{d}from"./pinia-c384ce02.js";import{c as v,a as I}from"./vue-router-dbd3f71f.js";import{bl as p}from"./index-8ab77898.js";import{U as g}from"./runtime-core.esm-bundler-a475101a.js";const y="modulepreload",k=function(t){return"/vite-vue/"+t},_={},c=function(r,o,s){if(!o||o.length===0)return r();const n=document.getElementsByTagName("link");return Promise.all(o.map(e=>{if(e=k(e),e in _)return;_[e]=!0;const i=e.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!s)for(let m=n.length-1;m>=0;m--){const h=n[m];if(h.href===e&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${e}"]${l}`))return;const a=document.createElement("link");if(a.rel=i?"stylesheet":y,i||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),i)return new Promise((m,h)=>{a.addEventListener("load",m),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${e}`)))})})).then(()=>r())},D=[],L=[{path:"/:pathMatch(.*)*",redirect:"/404"},{path:"/login",component:()=>c(()=>import("./login-08f64741.js"),["assets/login-08f64741.js","assets/index-87858b03.js","assets/runtime-core.esm-bundler-a475101a.js","assets/index-f63bc266.css","assets/class-particle-c47c3714.js","assets/class-getRandom-e7b7b8ef.js","assets/index-8ab77898.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/pinia-c384ce02.js","assets/vue-router-dbd3f71f.js","assets/login-a3b45f91.css"]),name:"login",meta:{title:"登录"},beforeEnter(t,r){const{state:o}=w();if(console.log(o),o.expiration)return{name:"home",replace:!0}}},{path:"",component:()=>c(()=>import("./layout-eeb46d3e.js"),["assets/layout-eeb46d3e.js","assets/index-8ab77898.js","assets/runtime-core.esm-bundler-a475101a.js","assets/index-87858b03.js","assets/index-f63bc266.css","assets/vue-router-dbd3f71f.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/pinia-c384ce02.js","assets/layout-60b9be72.css"]),children:[{path:"",component:()=>c(()=>import("./home-e2933da6.js"),["assets/home-e2933da6.js","assets/runtime-core.esm-bundler-a475101a.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/pinia-c384ce02.js","assets/vue-router-dbd3f71f.js","assets/index-8ab77898.js","assets/home-8dca77bd.css"]),name:"home",meta:{title:"首页"}},{path:"404",component:()=>c(()=>import("./404-b8d1f92b.js"),["assets/404-b8d1f92b.js","assets/vue-router-dbd3f71f.js","assets/runtime-core.esm-bundler-a475101a.js","assets/service-30d218b5.js","assets/index-8ab77898.js"]),name:"404",meta:{title:"404，找不到你要的了"}},{path:"table",component:()=>c(()=>import("./table-fc1fb745.js"),["assets/table-fc1fb745.js","assets/pinia-c384ce02.js","assets/runtime-core.esm-bundler-a475101a.js","assets/index-8ab77898.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/table-3143a568.css"]),name:"table",meta:{title:"表格"}},{path:"particle",component:()=>c(()=>import("./particle-4dec962e.js"),["assets/particle-4dec962e.js","assets/class-particle-c47c3714.js","assets/class-getRandom-e7b7b8ef.js","assets/index-87858b03.js","assets/runtime-core.esm-bundler-a475101a.js","assets/index-f63bc266.css","assets/_plugin-vue_export-helper-c27b6911.js","assets/particle-ca1e29c9.css"]),name:"particle",meta:{title:"粒子动画"}},{path:"snow",component:()=>c(()=>import("./snow-4d9d8b29.js"),["assets/snow-4d9d8b29.js","assets/index-87858b03.js","assets/runtime-core.esm-bundler-a475101a.js","assets/index-f63bc266.css","assets/class-getRandom-e7b7b8ef.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/snow-d0309997.css"]),name:"snow",meta:{title:"雪飘"}}]},{path:"/demo",component:()=>c(()=>import("./demo-b20147ad.js"),["assets/demo-b20147ad.js","assets/runtime-core.esm-bundler-a475101a.js"]),name:"demo",meta:{title:"demo"}}],O=v("/vite-vue/"),u=I({history:O,routes:L});u.beforeEach(t=>{const{state:r}=w(),o=Boolean(r.expiration);if(t.name==="login")return o?"/":!0;if(!T(t.path)&&!o)return"/login"});u.afterEach(t=>{const r=t.meta.title;typeof r=="string"&&(document.title=r)});function T(t){return D.some(r=>t.startsWith(r))}const w=d("auth",()=>{const t=g(E());let r=0;const o=async()=>{clearTimeout(r),localStorage.removeItem("auth"),localStorage.removeItem("token"),Object.assign(t,E());try{await u.push("/login")}catch(n){console.error(n)}},s=async({user:n,expiration:e,token:i},l=!1)=>{clearTimeout(r),r=setTimeout(s,e-Date.now());const f={user:n,token:i,expiration:e};l&&(localStorage.setItem("auth",JSON.stringify(f)),localStorage.setItem("token",i)),Object.assign(t,f);try{u.currentRoute.value.name==="login"&&await u.replace({name:"home"})}catch(a){console.error(a)}};return{state:t,signOut:o,signIn:s}});function E(){const t={user:"",token:"",expiration:0};try{const r=localStorage.getItem("auth");if(!r)return t;const o=JSON.parse(r),{user:s,token:n,expiration:e}=o;if(!s||!n||!e)throw new Error("There are fields that are empty");if(typeof s!="string")throw new Error("The user field is not a string");if(typeof n!="string")throw new Error("The token field is not a string");if(typeof e!="number")throw new Error("The expiration field is not a number");if(e-Date.now()<1e3*60*5)throw new Error("token has expired");return{user:s,token:n,expiration:e}}catch(r){console.error(r),localStorage.removeItem("auth"),localStorage.removeItem("token"),p.warning("登录信息已失效")}return t}const U=d("themeState",()=>{const t=g({isDark:!1,currentUser:"",currentPage:"",userPermission:[]});return{state:t,actIsDark:o=>{const s=document.documentElement.classList;t.isDark=o,t.isDark?s.add("dark"):s.remove("dark")}}}),x=d("user",()=>{const t=g(S());return{state:t,register:({user:n,pwd:e})=>{const i=crypto.randomUUID();t.push({user:n,pwd:e,id:i}),console.log(t)},loginOut:n=>{try{const e=t.findIndex(i=>i.id===n);if(e===-1)throw new Error;t.splice(e,1)}catch{p.warning("no user")}},validate:({user:n,pwd:e})=>{const i=t.find(l=>l.user===n);try{if(!i)throw new Error;if(i.pwd===e)return!0}catch{p.warning("用户或密码错误")}return!1}}});function S(){return[{id:crypto.randomUUID(),user:"admin",pwd:"admin"},{id:crypto.randomUUID(),user:"123456",pwd:"123456"}]}export{x as a,w as b,u as r,U as u};
